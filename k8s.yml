---
 - hosts: docker_k8s
   user: root
   tasks:
     - name: Run docker build on dockerhost
       shell: "cd /home/ansible_admin/CI_CD_Pipeline_FlaskApp; docker build -t flaskapp_dockerized ."
     - name: Login to dockerhub
       shell: "docker login -u 'engineermarion29' -p 'HirayaManawari@0829' docker.io"
     - name: Docker tag and push to DockerHub
       shell: "docker tag flaskapp_dockerized:latest engineermarion29/flaskapp_dockerized_dh:latest;docker push engineermarion29/flaskapp_dockerized_dh:latest"
     - name: Deploy app in pods
       shell: "/usr/local/bin/kubectl apply -f flaskapp_pods.yaml"
     - name: Create service for k8s pods
       shell: "/usr/local/bin/kubectl apply -f flaskapp_service.yaml"
     - name: Update deployment file
       shell: "/usr/local/bin/kubectl rollout restsart deployment.v1.apps./flask-app-k8s"
